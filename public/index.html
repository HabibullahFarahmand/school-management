<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EduCore â€” School Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f0f4ff;
    --surface: #ffffff;
    --surface2: #f8faff;
    --border: #dde4f5;
    --accent: #4361ee;
    --accent2: #4cc9f0;
    --green: #06c272;
    --red: #f03e3e;
    --yellow: #f59f00;
    --text: #1a1f36;
    --muted: #7c8db5;
    --sidebar-w: 260px;
    --sidebar-bg: #1e2756;
    --sidebar-text: #c2caf0;
    --sidebar-active: #4361ee;
    --sidebar-hover: rgba(255,255,255,0.07);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
  h1,h2,h3,h4 { font-family: 'Syne', sans-serif; }

  /* ====== LOGIN ====== */
  #login-screen {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #e8eeff 0%, #f5f0ff 50%, #e0f7fa 100%);
    position: relative;
    overflow: hidden;
  }
  #login-screen::before {
    content: '';
    position: absolute;
    top: -100px; left: -100px;
    width: 500px; height: 500px;
    background: radial-gradient(circle, rgba(67,97,238,0.12) 0%, transparent 70%);
    border-radius: 50%;
  }
  #login-screen::after {
    content: '';
    position: absolute;
    bottom: -100px; right: -50px;
    width: 400px; height: 400px;
    background: radial-gradient(circle, rgba(76,201,240,0.12) 0%, transparent 70%);
    border-radius: 50%;
  }
  .login-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 48px;
    width: 440px;
    box-shadow: 0 20px 60px rgba(67,97,238,0.12), 0 4px 16px rgba(0,0,0,0.06);
    position: relative; z-index: 1;
  }
  .login-logo { font-family: 'Syne', sans-serif; font-size: 32px; font-weight: 800; background: linear-gradient(135deg, var(--accent), #7b5ea7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px; }
  .login-sub { color: var(--muted); font-size: 14px; margin-bottom: 36px; }
  .form-group { margin-bottom: 20px; }
  .form-group label { display: block; font-size: 12px; font-weight: 600; color: var(--muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.07em; }
  .form-control {
    width: 100%; background: var(--surface2); border: 1.5px solid var(--border); border-radius: 10px;
    padding: 12px 16px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .form-control:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(67,97,238,0.1); background: #fff; }
  .form-control option { background: #fff; color: var(--text); }
  .btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 12px 20px; border-radius: 10px; border: none; cursor: pointer;
    font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 600;
    transition: all 0.2s; text-decoration: none;
  }
  .btn-primary { background: var(--accent); color: white; box-shadow: 0 4px 14px rgba(67,97,238,0.35); }
  .btn-primary:hover { background: #3451d1; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(67,97,238,0.45); }
  .btn-success { background: var(--green); color: white; box-shadow: 0 4px 14px rgba(6,194,114,0.3); }
  .btn-success:hover { background: #05a85f; }
  .btn-danger { background: var(--red); color: white; }
  .btn-danger:hover { background: #d62f2f; }
  .btn-secondary { background: var(--surface2); color: var(--text); border: 1.5px solid var(--border); }
  .btn-secondary:hover { background: var(--border); }
  .btn-warning { background: var(--yellow); color: #fff; }
  .btn-sm { padding: 6px 12px; font-size: 12px; }
  .btn-full { width: 100%; }
  .login-hint { margin-top: 20px; padding: 12px 16px; background: #f0f4ff; border: 1px solid #dde4f5; border-radius: 10px; font-size: 12px; color: var(--muted); line-height: 1.8; }

  /* ====== LAYOUT ====== */
  #app { display: none; }
  .layout { display: flex; min-height: 100vh; }

  /* SIDEBAR */
  .sidebar {
    width: var(--sidebar-w); background: var(--sidebar-bg);
    display: flex; flex-direction: column; position: fixed; top: 0; left: 0; height: 100vh;
    z-index: 100; box-shadow: 4px 0 24px rgba(30,39,86,0.15);
  }
  .sidebar-logo { padding: 28px 24px 20px; border-bottom: 1px solid rgba(255,255,255,0.08); }
  .sidebar-logo span { font-family: 'Syne', sans-serif; font-size: 24px; font-weight: 800; color: #fff; display: flex; align-items: center; gap: 8px; }
  .sidebar-logo span::before { content: 'ðŸŽ“'; font-size: 22px; }
  .sidebar-logo small { display: block; font-size: 11px; color: rgba(194,202,240,0.6); margin-top: 4px; padding-left: 32px; }
  .sidebar-nav { flex: 1; overflow-y: auto; padding: 12px 0; }
  .sidebar-nav::-webkit-scrollbar { width: 4px; }
  .sidebar-nav::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 4px; }
  .nav-section { padding: 16px 24px 6px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.12em; color: rgba(194,202,240,0.45); font-weight: 700; }
  .nav-item {
    display: flex; align-items: center; gap: 12px; padding: 10px 16px; margin: 2px 10px;
    border-radius: 10px; cursor: pointer; transition: all 0.15s; color: var(--sidebar-text);
    font-size: 14px; font-weight: 500;
  }
  .nav-item:hover { background: var(--sidebar-hover); color: #fff; }
  .nav-item.active { background: var(--sidebar-active); color: #fff; box-shadow: 0 4px 12px rgba(67,97,238,0.4); }
  .nav-item .icon { width: 20px; height: 20px; flex-shrink: 0; opacity: 0.85; }
  .nav-item.active .icon { opacity: 1; }
  .sidebar-footer { padding: 16px; border-top: 1px solid rgba(255,255,255,0.08); }
  .user-info { display: flex; align-items: center; gap: 12px; }
  .avatar { width: 38px; height: 38px; border-radius: 10px; background: linear-gradient(135deg, #4361ee, #7b5ea7); display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 15px; color: white; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.25); }
  .user-details { flex: 1; min-width: 0; }
  .user-name { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #fff; }
  .user-role { font-size: 11px; color: var(--accent2); text-transform: capitalize; }

  /* MAIN */
  .main { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }
  .topbar { background: var(--surface); border-bottom: 1.5px solid var(--border); padding: 16px 32px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 8px rgba(67,97,238,0.05); }
  .page-title { font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 700; color: var(--text); }
  .content { padding: 28px 32px; flex: 1; }

  /* ====== CARDS ====== */
  .card { background: var(--surface); border: 1.5px solid var(--border); border-radius: 16px; padding: 24px; box-shadow: 0 2px 12px rgba(67,97,238,0.05); }
  .card-title { font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 700; margin-bottom: 16px; color: var(--text); }

  /* STATS GRID */
  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 28px; }
  .stat-card { background: var(--surface); border: 1.5px solid var(--border); border-radius: 16px; padding: 24px; position: relative; overflow: hidden; box-shadow: 0 2px 12px rgba(67,97,238,0.06); }
  .stat-card::before { content: ''; position: absolute; top: -24px; right: -24px; width: 90px; height: 90px; border-radius: 50%; opacity: 0.08; }
  .stat-card.blue::before { background: var(--accent); }
  .stat-card.cyan::before { background: var(--accent2); }
  .stat-card.green::before { background: var(--green); }
  .stat-card.yellow::before { background: var(--yellow); }
  .stat-icon { width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px; }
  .stat-icon.blue { background: rgba(67,97,238,0.1); color: var(--accent); }
  .stat-icon.cyan { background: rgba(76,201,240,0.12); color: #0ea5d4; }
  .stat-icon.green { background: rgba(6,194,114,0.1); color: var(--green); }
  .stat-icon.yellow { background: rgba(245,159,0,0.12); color: var(--yellow); }
  .stat-value { font-family: 'Syne', sans-serif; font-size: 36px; font-weight: 800; line-height: 1; color: var(--text); }
  .stat-label { font-size: 13px; color: var(--muted); margin-top: 4px; font-weight: 500; }

  /* TABLE */
  .table-wrap { overflow-x: auto; border-radius: 12px; }
  table { width: 100%; border-collapse: collapse; }
  th { background: var(--surface2); padding: 12px 16px; text-align: left; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); }
  th:first-child { border-radius: 8px 0 0 8px; }
  th:last-child { border-radius: 0 8px 8px 0; }
  td { padding: 14px 16px; font-size: 14px; border-bottom: 1px solid var(--border); color: var(--text); }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: rgba(67,97,238,0.02); }

  /* BADGES */
  .badge { display: inline-flex; align-items: center; padding: 3px 10px; border-radius: 999px; font-size: 11px; font-weight: 700; }
  .badge-green { background: rgba(6,194,114,0.12); color: #059552; }
  .badge-red { background: rgba(240,62,62,0.1); color: var(--red); }
  .badge-yellow { background: rgba(245,159,0,0.12); color: #c47f00; }
  .badge-blue { background: rgba(67,97,238,0.1); color: var(--accent); }
  .badge-muted { background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }

  /* MODAL */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(30,39,86,0.35); display: flex; align-items: center;
    justify-content: center; z-index: 1000; backdrop-filter: blur(6px); display: none;
  }
  .modal-overlay.open { display: flex; }
  .modal { background: var(--surface); border: 1.5px solid var(--border); border-radius: 20px; padding: 32px; width: 90%; max-width: 520px; max-height: 90vh; overflow-y: auto; box-shadow: 0 24px 60px rgba(30,39,86,0.2); }
  .modal-title { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 24px; color: var(--text); }
  .modal-footer { display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

  /* TOOLBAR */
  .toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
  .search-box { flex: 1; max-width: 320px; position: relative; }
  .search-box input { width: 100%; padding: 10px 16px 10px 40px; background: var(--surface2); border: 1.5px solid var(--border); border-radius: 10px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; }
  .search-box input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(67,97,238,0.1); }
  .search-box svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--muted); width: 16px; height: 16px; }

  /* GRID 2 */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }

  /* ANNOUNCE CARD */
  .announce-item { padding: 16px; border: 1.5px solid var(--border); border-radius: 12px; margin-bottom: 12px; background: var(--surface2); transition: border-color 0.2s; }
  .announce-item:hover { border-color: rgba(67,97,238,0.3); }
  .announce-item:last-child { margin-bottom: 0; }
  .announce-title { font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700; margin-bottom: 6px; color: var(--text); }
  .announce-meta { font-size: 12px; color: var(--muted); }
  .announce-body { font-size: 13px; margin-top: 8px; line-height: 1.6; color: #5a6a8a; }

  /* TIMETABLE */
  .tt-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
  .tt-day { background: var(--surface2); border-radius: 12px; padding: 14px; border: 1.5px solid var(--border); }
  .tt-day-name { font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 800; margin-bottom: 10px; color: var(--accent); text-transform: uppercase; letter-spacing: 0.05em; }
  .tt-slot { background: var(--surface); border-radius: 8px; padding: 10px; margin-bottom: 8px; border: 1px solid var(--border); }
  .tt-slot:last-child { margin-bottom: 0; }
  .tt-slot-subject { font-size: 12px; font-weight: 700; color: var(--text); }
  .tt-slot-time { font-size: 10px; color: var(--muted); margin-top: 3px; }

  /* Attendance */
  .att-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid var(--border); }
  .att-row:last-child { border-bottom: none; }
  .att-btns { display: flex; gap: 6px; }
  .att-btn { padding: 6px 16px; border-radius: 8px; border: 1.5px solid var(--border); background: var(--surface2); cursor: pointer; font-size: 12px; font-weight: 700; transition: all 0.15s; color: var(--muted); }
  .att-btn.present.active { background: rgba(6,194,114,0.1); border-color: var(--green); color: #059552; }
  .att-btn.absent.active { background: rgba(240,62,62,0.1); border-color: var(--red); color: var(--red); }
  .att-btn.late.active { background: rgba(245,159,0,0.1); border-color: var(--yellow); color: #c47f00; }
  .att-btn:hover { background: var(--border); }

  /* Error */
  .error-msg { background: rgba(240,62,62,0.08); border: 1.5px solid rgba(240,62,62,0.25); border-radius: 10px; padding: 12px 16px; color: var(--red); font-size: 13px; margin-bottom: 16px; display: none; }
  .success-msg { background: rgba(6,194,114,0.08); border: 1.5px solid rgba(6,194,114,0.25); border-radius: 10px; padding: 12px 16px; color: var(--green); font-size: 13px; margin-bottom: 16px; display: none; }

  /* Toast */
  #toast { position: fixed; bottom: 24px; right: 24px; z-index: 9999; }
  .toast-item { background: var(--surface); border: 1.5px solid var(--border); border-radius: 12px; padding: 14px 20px; margin-top: 10px; font-size: 13px; box-shadow: 0 10px 40px rgba(30,39,86,0.15); display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease; color: var(--text); }
  .toast-item.success { border-left: 3px solid var(--green); }
  .toast-item.error { border-left: 3px solid var(--red); }
  @keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(120%); opacity: 0; } }

  select.form-control { appearance: none; cursor: pointer; }
  .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); }
  .empty-state svg { width: 60px; height: 60px; opacity: 0.2; margin-bottom: 16px; }
  .empty-state p { font-size: 15px; font-weight: 500; }

  /* ====== HAMBURGER BUTTON ====== */
  .menu-toggle {
    display: none;
    align-items: center;
    justify-content: center;
    width: 40px; height: 40px;
    border-radius: 10px;
    background: var(--surface2);
    border: 1.5px solid var(--border);
    cursor: pointer;
    color: var(--text);
    flex-shrink: 0;
  }

  /* ====== SIDEBAR OVERLAY (mobile) ====== */
  .sidebar-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(30,39,86,0.45);
    z-index: 99;
    backdrop-filter: blur(2px);
  }
  .sidebar-overlay.open { display: block; }

  /* ====== RESPONSIVE BREAKPOINTS ====== */

  /* Large tablets / small laptops */
  @media (max-width: 1200px) {
    :root { --sidebar-w: 220px; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .content { padding: 24px; }
  }

  /* Tablets */
  @media (max-width: 1024px) {
    .topbar { padding: 14px 20px; }
    .content { padding: 20px; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .tt-grid { grid-template-columns: repeat(3, 1fr); }
  }

  /* Small tablets / large phones (landscape) */
  @media (max-width: 768px) {
    :root { --sidebar-w: 260px; }

    /* Show hamburger */
    .menu-toggle { display: flex; }

    /* Sidebar: slide out off-screen */
    .sidebar {
      transform: translateX(-100%);
      transition: transform 0.28s cubic-bezier(0.4,0,0.2,1);
      z-index: 200;
    }
    .sidebar.open { transform: translateX(0); }

    /* Main fills full width */
    .main { margin-left: 0; }

    /* Topbar */
    .topbar { padding: 12px 16px; gap: 10px; }
    .page-title { font-size: 18px; }

    /* Content */
    .content { padding: 16px; }

    /* Stats */
    .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
    .stat-value { font-size: 28px; }
    .stat-card { padding: 18px; }
    .stat-icon { width: 40px; height: 40px; border-radius: 12px; margin-bottom: 12px; }

    /* Cards */
    .card { padding: 18px; }

    /* Forms */
    .form-row { grid-template-columns: 1fr; gap: 0; }
    .grid-2 { grid-template-columns: 1fr; gap: 16px; }

    /* Timetable */
    .tt-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }

    /* Tables */
    .table-wrap { border-radius: 8px; -webkit-overflow-scrolling: touch; }
    td, th { padding: 10px 12px; font-size: 13px; }

    /* Toolbar */
    .toolbar { gap: 8px; }
    .search-box { max-width: 100%; flex: 1 1 180px; }

    /* Login */
    .login-card { width: 92%; padding: 32px 24px; border-radius: 20px; }
    .login-logo { font-size: 26px; }

    /* Modal */
    .modal { width: 94%; padding: 24px 20px; border-radius: 16px; }

    /* Toast */
    #toast { left: 16px; right: 16px; bottom: 16px; }
    .toast-item { width: 100%; }

    /* Attendance rows */
    .att-row { flex-wrap: wrap; gap: 8px; }
    .att-btns { flex-wrap: wrap; }

    /* Buttons in topbar */
    #topbar-actions .btn { font-size: 13px; padding: 9px 14px; }
  }

  /* Phones */
  @media (max-width: 480px) {
    .stats-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
    .stat-card { padding: 14px; }
    .stat-value { font-size: 24px; }
    .stat-label { font-size: 11px; }
    .stat-icon { width: 36px; height: 36px; margin-bottom: 10px; }

    .content { padding: 12px; }
    .topbar { padding: 10px 12px; }
    .page-title { font-size: 16px; }

    .card { padding: 14px; border-radius: 12px; }
    .card-title { font-size: 14px; }

    /* Timetable stacks to 1 col on very small screens */
    .tt-grid { grid-template-columns: 1fr; }

    /* Login */
    .login-card { width: 96%; padding: 24px 16px; }
    .login-logo { font-size: 22px; }
    .login-sub { font-size: 12px; margin-bottom: 24px; }

    /* Modal */
    .modal { width: 98%; padding: 20px 16px; }
    .modal-title { font-size: 17px; margin-bottom: 18px; }

    /* Tables: hide less-important cols */
    td, th { padding: 8px 10px; font-size: 12px; }

    .btn-sm { padding: 5px 10px; font-size: 11px; }

    /* Topbar actions */
    #topbar-actions .btn { font-size: 12px; padding: 8px 12px; }

    /* Announcement */
    .announce-item { padding: 12px; }
    .announce-title { font-size: 14px; }
  }

  /* Extra small phones */
  @media (max-width: 360px) {
    .stats-grid { grid-template-columns: 1fr; }
    .att-btns { flex-direction: column; }
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-card">
    <div class="login-logo">EduCore</div>
    <div class="login-sub">School Management System â€” Sign in to continue</div>
    <div id="login-error" class="error-msg"></div>
    <div class="form-group">
      <label>Username</label>
      <input class="form-control" id="login-username" type="text" placeholder="Enter username" autocomplete="username">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input class="form-control" id="login-password" type="password" placeholder="Enter password" autocomplete="current-password">
    </div>
    <button class="btn btn-primary btn-full" onclick="login()" style="padding:14px;">Sign In</button>
    <div class="login-hint">
      ðŸ”‘ Demo accounts:<br>
      <strong>Admin:</strong> admin / admin123<br>
      <strong>Teacher:</strong> smith / teacher123<br>
      <strong>Student:</strong> alice / student123
    </div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="layout">
    <!-- Mobile sidebar overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <span>EduCore</span>
        <small>School Management System</small>
      </div>
      <nav class="sidebar-nav" id="sidebar-nav"></nav>
      <div class="sidebar-footer">
        <div class="user-info">
          <div class="avatar" id="user-avatar">A</div>
          <div class="user-details">
            <div class="user-name" id="user-name">Administrator</div>
            <div class="user-role" id="user-role">admin</div>
          </div>
          <button onclick="logout()" style="background:none;border:none;cursor:pointer;color:rgba(194,202,240,0.6);" title="Logout">
            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/></svg>
          </button>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="topbar">
        <div style="display:flex;align-items:center;gap:12px;min-width:0;">
          <button class="menu-toggle" id="menu-toggle" onclick="toggleSidebar()" aria-label="Toggle menu">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <h1 class="page-title" id="page-title">Dashboard</h1>
        </div>
        <div id="topbar-actions" style="flex-shrink:0;"></div>
      </div>
      <div class="content" id="page-content">
        <div class="empty-state"><p>Loading...</p></div>
      </div>
    </main>
  </div>
</div>

<!-- MODALS -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal" id="modal-content"></div>
</div>

<div id="toast"></div>

<script>
const API = '';
let currentUser = null;
let currentPage = 'dashboard';

// ==================== API ====================
async function api(method, url, data) {
  const opts = { method, credentials: 'include', headers: { 'Content-Type': 'application/json' } };
  if (data) opts.body = JSON.stringify(data);
  const r = await fetch(API + url, opts);
  const json = await r.json();
  if (!r.ok) throw new Error(json.error || 'Request failed');
  return json;
}
const get = url => api('GET', url);
const post = (url, d) => api('POST', url, d);
const put = (url, d) => api('PUT', url, d);
const del = url => api('DELETE', url);

// ==================== AUTH ====================
async function login() {
  const username = document.getElementById('login-username').value;
  const password = document.getElementById('login-password').value;
  const errEl = document.getElementById('login-error');
  errEl.style.display = 'none';
  try {
    const res = await post('/api/auth/login', { username, password });
    currentUser = res.user;
    showApp();
  } catch (e) {
    errEl.textContent = e.message;
    errEl.style.display = 'block';
  }
}

async function logout() {
  await post('/api/auth/logout');
  currentUser = null;
  document.getElementById('app').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('login-password').value = '';
}

document.getElementById('login-password').addEventListener('keydown', e => { if (e.key === 'Enter') login(); });
document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeSidebar(); closeModal(); } });

// ==================== INIT ====================
async function init() {
  try {
    currentUser = await get('/api/auth/me');
    showApp();
  } catch { /* not logged in */ }
}

function showApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  document.getElementById('user-avatar').textContent = currentUser.name[0].toUpperCase();
  document.getElementById('user-name').textContent = currentUser.name;
  document.getElementById('user-role').textContent = currentUser.role;
  buildSidebar();
  navigate('dashboard');
}

// ==================== SIDEBAR TOGGLE ====================
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebar-overlay');
  sidebar.classList.toggle('open');
  overlay.classList.toggle('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('open');
}

// ==================== NAVIGATION ====================
const NAV_CONFIG = {
  admin: [
    { section: 'Overview' },
    { id: 'dashboard', label: 'Dashboard', icon: iconDashboard },
    { id: 'announcements', label: 'Announcements', icon: iconAnnounce },
    { section: 'Academic' },
    { id: 'students', label: 'Students', icon: iconStudents },
    { id: 'teachers', label: 'Teachers', icon: iconTeachers },
    { id: 'classes', label: 'Classes', icon: iconClasses },
    { id: 'subjects', label: 'Subjects', icon: iconSubjects },
    { section: 'Records' },
    { id: 'attendance', label: 'Attendance', icon: iconAttend },
    { id: 'grades', label: 'Grades', icon: iconGrades },
    { id: 'fees', label: 'Fees', icon: iconFees },
    { id: 'timetable', label: 'Timetable', icon: iconTT },
  ],
  teacher: [
    { section: 'Overview' },
    { id: 'dashboard', label: 'Dashboard', icon: iconDashboard },
    { id: 'announcements', label: 'Announcements', icon: iconAnnounce },
    { section: 'Academic' },
    { id: 'students', label: 'Students', icon: iconStudents },
    { id: 'classes', label: 'Classes', icon: iconClasses },
    { section: 'Records' },
    { id: 'attendance', label: 'Attendance', icon: iconAttend },
    { id: 'grades', label: 'Grades', icon: iconGrades },
    { id: 'timetable', label: 'Timetable', icon: iconTT },
  ],
  student: [
    { section: 'Overview' },
    { id: 'dashboard', label: 'Dashboard', icon: iconDashboard },
    { id: 'announcements', label: 'Announcements', icon: iconAnnounce },
    { section: 'My Records' },
    { id: 'grades', label: 'My Grades', icon: iconGrades },
    { id: 'timetable', label: 'Timetable', icon: iconTT },
    { id: 'fees', label: 'Fees', icon: iconFees },
  ]
};

function buildSidebar() {
  const nav = document.getElementById('sidebar-nav');
  const items = NAV_CONFIG[currentUser.role] || NAV_CONFIG.student;
  nav.innerHTML = items.map(item => {
    if (item.section) return `<div class="nav-section">${item.section}</div>`;
    return `<div class="nav-item" id="nav-${item.id}" onclick="navigate('${item.id}')">
      <span class="icon">${item.icon()}</span>
      <span>${item.label}</span>
    </div>`;
  }).join('');
}

function navigate(page) {
  currentPage = page;
  // Close sidebar on mobile after navigation
  if (window.innerWidth <= 768) closeSidebar();
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  const el = document.getElementById(`nav-${page}`);
  if (el) el.classList.add('active');
  const titles = { dashboard: 'Dashboard', students: 'Students', teachers: 'Teachers', classes: 'Classes', subjects: 'Subjects', attendance: 'Attendance', grades: 'Grades', fees: 'Fees', timetable: 'Timetable', announcements: 'Announcements' };
  document.getElementById('page-title').textContent = titles[page] || page;
  document.getElementById('topbar-actions').innerHTML = '';
  const renderers = { dashboard: renderDashboard, students: renderStudents, teachers: renderTeachers, classes: renderClasses, subjects: renderSubjects, attendance: renderAttendance, grades: renderGrades, fees: renderFees, timetable: renderTimetable, announcements: renderAnnouncements };
  if (renderers[page]) renderers[page]();
}

// ==================== TOAST ====================
function toast(msg, type = 'success') {
  const el = document.createElement('div');
  el.className = `toast-item ${type}`;
  el.innerHTML = (type === 'success' ? 'âœ…' : 'âŒ') + ' ' + msg;
  document.getElementById('toast').appendChild(el);
  setTimeout(() => { el.style.animation = 'slideOut 0.3s ease forwards'; setTimeout(() => el.remove(), 300); }, 3000);
}

// ==================== MODAL ====================
function openModal(html) {
  document.getElementById('modal-content').innerHTML = html;
  document.getElementById('modal-overlay').classList.add('open');
}
function closeModal(e) {
  if (!e || e.target === document.getElementById('modal-overlay')) {
    document.getElementById('modal-overlay').classList.remove('open');
  }
}

// ==================== DASHBOARD ====================
async function renderDashboard() {
  const content = document.getElementById('page-content');
  content.innerHTML = '<div class="empty-state"><p>Loading...</p></div>';
  const [stats] = await Promise.all([get('/api/dashboard/stats')]);

  content.innerHTML = `
    <div class="stats-grid">
      <div class="stat-card blue">
        <div class="stat-icon blue">${iconStudents()}</div>
        <div class="stat-value">${stats.totalStudents}</div>
        <div class="stat-label">Total Students</div>
      </div>
      <div class="stat-card cyan">
        <div class="stat-icon cyan">${iconTeachers()}</div>
        <div class="stat-value">${stats.totalTeachers}</div>
        <div class="stat-label">Teachers</div>
      </div>
      <div class="stat-card green">
        <div class="stat-icon green">${iconClasses()}</div>
        <div class="stat-value">${stats.totalClasses}</div>
        <div class="stat-label">Classes</div>
      </div>
      <div class="stat-card yellow">
        <div class="stat-icon yellow">${iconSubjects()}</div>
        <div class="stat-value">${stats.totalSubjects}</div>
        <div class="stat-label">Subjects</div>
      </div>
    </div>
    <div class="grid-2">
      <div class="card">
        <div class="card-title">Today's Attendance</div>
        <div style="display:flex;gap:20px;align-items:center;padding:10px 0;">
          <div style="flex:1;text-align:center;">
            <div style="font-family:Syne,sans-serif;font-size:40px;font-weight:800;color:var(--green)">${stats.presentToday}</div>
            <div style="color:var(--muted);font-size:13px;margin-top:4px;">Present</div>
          </div>
          <div style="width:1px;background:var(--border);height:60px;"></div>
          <div style="flex:1;text-align:center;">
            <div style="font-family:Syne,sans-serif;font-size:40px;font-weight:800;color:var(--red)">${stats.absentToday}</div>
            <div style="color:var(--muted);font-size:13px;margin-top:4px;">Absent</div>
          </div>
          <div style="width:1px;background:var(--border);height:60px;"></div>
          <div style="flex:1;text-align:center;">
            <div style="font-family:Syne,sans-serif;font-size:40px;font-weight:800;color:var(--yellow)">${stats.pendingFees}</div>
            <div style="color:var(--muted);font-size:13px;margin-top:4px;">Pending Fees</div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">Recent Announcements</div>
        ${stats.recentAnnouncements.length ? stats.recentAnnouncements.slice(0,3).map(a => `
          <div class="announce-item">
            <div class="announce-title">${esc(a.title)}</div>
            <div class="announce-meta">By ${esc(a.author_name)} Â· ${formatDate(a.created_at)}</div>
          </div>
        `).join('') : '<div class="empty-state" style="padding:30px;"><p>No announcements</p></div>'}
      </div>
    </div>
  `;
}

// ==================== STUDENTS ====================
async function renderStudents() {
  const content = document.getElementById('page-content');
  if (['admin'].includes(currentUser.role)) {
    document.getElementById('topbar-actions').innerHTML = `<button class="btn btn-primary" onclick="openAddStudent()">+ Add Student</button>`;
  }
  content.innerHTML = `
    <div class="card">
      <div class="toolbar">
        <div class="search-box">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          <input type="text" id="student-search" placeholder="Search students..." oninput="loadStudents()">
        </div>
        <select class="form-control" id="class-filter" style="width:180px;" onchange="loadStudents()">
          <option value="">All Classes</option>
        </select>
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Roll No.</th><th>Name</th><th>Class</th><th>Gender</th><th>Parent</th><th>Actions</th></tr></thead>
          <tbody id="students-tbody"><tr><td colspan="6" style="text-align:center;padding:40px;color:var(--muted);">Loading...</td></tr></tbody>
        </table>
      </div>
    </div>
  `;
  await loadClassFilter('class-filter');
  await loadStudents();
}

async function loadStudents() {
  const search = document.getElementById('student-search')?.value || '';
  const classId = document.getElementById('class-filter')?.value || '';
  const students = await get(`/api/students?search=${encodeURIComponent(search)}&class_id=${classId}`);
  const tbody = document.getElementById('students-tbody');
  if (!students.length) { tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state" style="padding:40px;"><p>No students found</p></div></td></tr>`; return; }
  tbody.innerHTML = students.map(s => `
    <tr>
      <td><span class="badge badge-blue">${esc(s.roll_number)}</span></td>
      <td><strong>${esc(s.name)}</strong><br><small style="color:var(--muted)">${esc(s.email||'')}</small></td>
      <td>${s.class_name ? `${esc(s.class_name)}` : '<span class="badge badge-muted">Unassigned</span>'}</td>
      <td>${s.gender || 'â€”'}</td>
      <td>${s.parent_name || 'â€”'}<br><small style="color:var(--muted)">${s.parent_phone||''}</small></td>
      <td>
        ${currentUser.role !== 'student' ? `<button class="btn btn-sm btn-secondary" onclick="openEditStudent(${s.id})">Edit</button> ` : ''}
        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteStudent(${s.id})">Delete</button>` : ''}
      </td>
    </tr>
  `).join('');
}

async function openAddStudent() {
  const classes = await get('/api/classes');
  openModal(`
    <div class="modal-title">Add New Student</div>
    <div class="form-row">
      <div class="form-group"><label>Full Name *</label><input class="form-control" id="s-name" placeholder="Full Name"></div>
      <div class="form-group"><label>Roll Number *</label><input class="form-control" id="s-roll" placeholder="e.g. S005"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Username *</label><input class="form-control" id="s-username" placeholder="Username"></div>
      <div class="form-group"><label>Password *</label><input class="form-control" id="s-pw" type="password" placeholder="Password"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Email</label><input class="form-control" id="s-email" placeholder="Email"></div>
      <div class="form-group"><label>Date of Birth</label><input class="form-control" id="s-dob" type="date"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Gender</label>
        <select class="form-control" id="s-gender"><option value="">Select</option><option>Male</option><option>Female</option><option>Other</option></select>
      </div>
      <div class="form-group"><label>Class</label>
        <select class="form-control" id="s-class"><option value="">Select Class</option>${classes.map(c=>`<option value="${c.id}">${esc(c.name)}</option>`).join('')}</select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Parent Name</label><input class="form-control" id="s-parent" placeholder="Parent Name"></div>
      <div class="form-group"><label>Parent Phone</label><input class="form-control" id="s-phone" placeholder="Phone Number"></div>
    </div>
    <div class="form-group"><label>Address</label><input class="form-control" id="s-addr" placeholder="Address"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveStudent()">Add Student</button>
    </div>
  `);
}

async function saveStudent() {
  try {
    await post('/api/students', {
      name: v('s-name'), roll_number: v('s-roll'), username: v('s-username'), password: v('s-pw'),
      email: v('s-email'), date_of_birth: v('s-dob'), gender: v('s-gender'), class_id: v('s-class'),
      parent_name: v('s-parent'), parent_phone: v('s-phone'), address: v('s-addr')
    });
    closeModal(); toast('Student added!'); loadStudents();
  } catch (e) { toast(e.message, 'error'); }
}

async function openEditStudent(id) {
  const [s, classes] = await Promise.all([get(`/api/students/${id}`), get('/api/classes')]);
  openModal(`
    <div class="modal-title">Edit Student</div>
    <div class="form-row">
      <div class="form-group"><label>Full Name</label><input class="form-control" id="es-name" value="${esc(s.name||'')}"></div>
      <div class="form-group"><label>Email</label><input class="form-control" id="es-email" value="${esc(s.email||'')}"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Gender</label>
        <select class="form-control" id="es-gender">
          <option value="">Select</option><option ${s.gender==='Male'?'selected':''}>Male</option><option ${s.gender==='Female'?'selected':''}>Female</option><option ${s.gender==='Other'?'selected':''}>Other</option>
        </select>
      </div>
      <div class="form-group"><label>Class</label>
        <select class="form-control" id="es-class"><option value="">Select Class</option>${classes.map(c=>`<option value="${c.id}" ${s.class_id==c.id?'selected':''}>${esc(c.name)}</option>`).join('')}</select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Parent Name</label><input class="form-control" id="es-parent" value="${esc(s.parent_name||'')}"></div>
      <div class="form-group"><label>Parent Phone</label><input class="form-control" id="es-phone" value="${esc(s.parent_phone||'')}"></div>
    </div>
    <div class="form-group"><label>Date of Birth</label><input class="form-control" id="es-dob" type="date" value="${s.date_of_birth||''}"></div>
    <div class="form-group"><label>Address</label><input class="form-control" id="es-addr" value="${esc(s.address||'')}"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="updateStudent(${id})">Save Changes</button>
    </div>
  `);
}

async function updateStudent(id) {
  try {
    await put(`/api/students/${id}`, { name: v('es-name'), email: v('es-email'), gender: v('es-gender'), class_id: v('es-class'), parent_name: v('es-parent'), parent_phone: v('es-phone'), date_of_birth: v('es-dob'), address: v('es-addr') });
    closeModal(); toast('Student updated!'); loadStudents();
  } catch (e) { toast(e.message, 'error'); }
}

async function deleteStudent(id) {
  if (!confirm('Delete this student? This cannot be undone.')) return;
  try { await del(`/api/students/${id}`); toast('Student deleted!'); loadStudents(); } catch (e) { toast(e.message, 'error'); }
}

// ==================== TEACHERS ====================
async function renderTeachers() {
  const content = document.getElementById('page-content');
  if (currentUser.role === 'admin') {
    document.getElementById('topbar-actions').innerHTML = `<button class="btn btn-primary" onclick="openAddTeacher()">+ Add Teacher</button>`;
  }
  const teachers = await get('/api/teachers');
  content.innerHTML = `
    <div class="card">
      <div class="table-wrap">
        <table>
          <thead><tr><th>Name</th><th>Username</th><th>Email</th><th>Classes</th><th>Actions</th></tr></thead>
          <tbody>${teachers.length ? teachers.map(t => `
            <tr>
              <td><strong>${esc(t.name)}</strong></td>
              <td><span class="badge badge-muted">${esc(t.username)}</span></td>
              <td>${esc(t.email||'â€”')}</td>
              <td>${t.classes ? `<span class="badge badge-blue">${esc(t.classes)}</span>` : 'â€”'}</td>
              <td>${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteTeacher(${t.id})">Delete</button>` : ''}</td>
            </tr>
          `).join('') : `<tr><td colspan="5"><div class="empty-state" style="padding:40px;"><p>No teachers found</p></div></td></tr>`}</tbody>
        </table>
      </div>
    </div>
  `;
}

async function openAddTeacher() {
  openModal(`
    <div class="modal-title">Add New Teacher</div>
    <div class="form-row">
      <div class="form-group"><label>Full Name *</label><input class="form-control" id="t-name" placeholder="Full Name"></div>
      <div class="form-group"><label>Username *</label><input class="form-control" id="t-username" placeholder="Username"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Email</label><input class="form-control" id="t-email" placeholder="Email"></div>
      <div class="form-group"><label>Password *</label><input class="form-control" id="t-pw" type="password" placeholder="Password"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveTeacher()">Add Teacher</button>
    </div>
  `);
}

async function saveTeacher() {
  try {
    await post('/api/teachers', { name: v('t-name'), username: v('t-username'), email: v('t-email'), password: v('t-pw') });
    closeModal(); toast('Teacher added!'); renderTeachers();
  } catch (e) { toast(e.message, 'error'); }
}

async function deleteTeacher(id) {
  if (!confirm('Delete this teacher?')) return;
  try { await del(`/api/teachers/${id}`); toast('Deleted!'); renderTeachers(); } catch (e) { toast(e.message, 'error'); }
}

// ==================== CLASSES ====================
async function renderClasses() {
  const content = document.getElementById('page-content');
  if (currentUser.role === 'admin') {
    document.getElementById('topbar-actions').innerHTML = `<button class="btn btn-primary" onclick="openAddClass()">+ Add Class</button>`;
  }
  const classes = await get('/api/classes');
  content.innerHTML = `
    <div class="card">
      <div class="table-wrap">
        <table>
          <thead><tr><th>Name</th><th>Grade</th><th>Section</th><th>Teacher</th><th>Students</th><th>Capacity</th><th>Actions</th></tr></thead>
          <tbody>${classes.length ? classes.map(c => `
            <tr>
              <td><strong>${esc(c.name)}</strong></td>
              <td><span class="badge badge-blue">${esc(c.grade)}</span></td>
              <td>${esc(c.section||'â€”')}</td>
              <td>${esc(c.teacher_name||'â€”')}</td>
              <td>${c.student_count || 0}</td>
              <td>${c.capacity}</td>
              <td>${currentUser.role === 'admin' ? `
                <button class="btn btn-sm btn-secondary" onclick="openEditClass(${c.id})">Edit</button>
                <button class="btn btn-sm btn-danger" onclick="deleteClass(${c.id})">Delete</button>
              ` : ''}</td>
            </tr>
          `).join('') : `<tr><td colspan="7"><div class="empty-state" style="padding:40px;"><p>No classes found</p></div></td></tr>`}</tbody>
        </table>
      </div>
    </div>
  `;
}

async function openAddClass() {
  const teachers = await get('/api/teachers');
  openModal(`
    <div class="modal-title">Add New Class</div>
    <div class="form-row">
      <div class="form-group"><label>Class Name *</label><input class="form-control" id="c-name" placeholder="e.g. Class 10-A"></div>
      <div class="form-group"><label>Grade *</label><input class="form-control" id="c-grade" placeholder="e.g. 10"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Section</label><input class="form-control" id="c-section" placeholder="e.g. A"></div>
      <div class="form-group"><label>Capacity</label><input class="form-control" id="c-cap" type="number" value="30"></div>
    </div>
    <div class="form-group"><label>Class Teacher</label>
      <select class="form-control" id="c-teacher"><option value="">Select Teacher</option>${teachers.map(t=>`<option value="${t.id}">${esc(t.name)}</option>`).join('')}</select>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveClass()">Add Class</button>
    </div>
  `);
}

async function saveClass() {
  try {
    await post('/api/classes', { name: v('c-name'), grade: v('c-grade'), section: v('c-section'), capacity: v('c-cap'), teacher_id: v('c-teacher') });
    closeModal(); toast('Class added!'); renderClasses();
  } catch (e) { toast(e.message, 'error'); }
}

async function openEditClass(id) {
  const [classes, teachers] = await Promise.all([get('/api/classes'), get('/api/teachers')]);
  const c = classes.find(x => x.id === id);
  openModal(`
    <div class="modal-title">Edit Class</div>
    <div class="form-row">
      <div class="form-group"><label>Class Name</label><input class="form-control" id="ec-name" value="${esc(c.name)}"></div>
      <div class="form-group"><label>Grade</label><input class="form-control" id="ec-grade" value="${esc(c.grade)}"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Section</label><input class="form-control" id="ec-section" value="${esc(c.section||'')}"></div>
      <div class="form-group"><label>Capacity</label><input class="form-control" id="ec-cap" type="number" value="${c.capacity}"></div>
    </div>
    <div class="form-group"><label>Class Teacher</label>
      <select class="form-control" id="ec-teacher"><option value="">Select Teacher</option>${teachers.map(t=>`<option value="${t.id}" ${c.teacher_id==t.id?'selected':''}>${esc(t.name)}</option>`).join('')}</select>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="updateClass(${id})">Save</button>
    </div>
  `);
}

async function updateClass(id) {
  try {
    await put(`/api/classes/${id}`, { name: v('ec-name'), grade: v('ec-grade'), section: v('ec-section'), capacity: v('ec-cap'), teacher_id: v('ec-teacher') });
    closeModal(); toast('Class updated!'); renderClasses();
  } catch (e) { toast(e.message, 'error'); }
}

async function deleteClass(id) {
  if (!confirm('Delete this class?')) return;
  try { await del(`/api/classes/${id}`); toast('Deleted!'); renderClasses(); } catch (e) { toast(e.message, 'error'); }
}

// ==================== SUBJECTS ====================
async function renderSubjects() {
  const content = document.getElementById('page-content');
  if (currentUser.role === 'admin') {
    document.getElementById('topbar-actions').innerHTML = `<button class="btn btn-primary" onclick="openAddSubject()">+ Add Subject</button>`;
  }
  const subjects = await get('/api/subjects');
  content.innerHTML = `
    <div class="card">
      <div class="table-wrap">
        <table>
          <thead><tr><th>Name</th><th>Code</th><th>Class</th><th>Teacher</th><th>Actions</th></tr></thead>
          <tbody>${subjects.length ? subjects.map(s => `
            <tr>
              <td><strong>${esc(s.name)}</strong></td>
              <td><span class="badge badge-cyan">${esc(s.code)}</span></td>
              <td>${esc(s.class_name||'â€”')}</td>
              <td>${esc(s.teacher_name||'â€”')}</td>
              <td>${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteSubject(${s.id})">Delete</button>` : ''}</td>
            </tr>
          `).join('') : `<tr><td colspan="5"><div class="empty-state" style="padding:40px;"><p>No subjects found</p></div></td></tr>`}</tbody>
        </table>
      </div>
    </div>
  `;
}

async function openAddSubject() {
  const [classes, teachers] = await Promise.all([get('/api/classes'), get('/api/teachers')]);
  openModal(`
    <div class="modal-title">Add New Subject</div>
    <div class="form-row">
      <div class="form-group"><label>Subject Name *</label><input class="form-control" id="sub-name" placeholder="e.g. Mathematics"></div>
      <div class="form-group"><label>Code *</label><input class="form-control" id="sub-code" placeholder="e.g. MATH10"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Class</label>
        <select class="form-control" id="sub-class"><option value="">Select Class</option>${classes.map(c=>`<option value="${c.id}">${esc(c.name)}</option>`).join('')}</select>
      </div>
      <div class="form-group"><label>Teacher</label>
        <select class="form-control" id="sub-teacher"><option value="">Select Teacher</option>${teachers.map(t=>`<option value="${t.id}">${esc(t.name)}</option>`).join('')}</select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveSubject()">Add Subject</button>
    </div>
  `);
}

async function saveSubject() {
  try {
    await post('/api/subjects', { name: v('sub-name'), code: v('sub-code'), class_id: v('sub-class'), teacher_id: v('sub-teacher') });
    closeModal(); toast('Subject added!'); renderSubjects();
  } catch (e) { toast(e.message, 'error'); }
}

async function deleteSubject(id) {
  if (!confirm('Delete subject?')) return;
  try { await del(`/api/subjects/${id}`); toast('Deleted!'); renderSubjects(); } catch (e) { toast(e.message, 'error'); }
}

// ==================== ATTENDANCE ====================
async function renderAttendance() {
  const content = document.getElementById('page-content');
  const classes = await get('/api/classes');
  const today = new Date().toISOString().split('T')[0];
  content.innerHTML = `
    <div class="card" style="margin-bottom:20px;">
      <div class="toolbar" style="margin-bottom:0;">
        <div class="form-group" style="margin:0;flex:1;max-width:200px;"><label style="font-size:11px;color:var(--muted);margin-bottom:6px;display:block;">CLASS</label>
          <select class="form-control" id="att-class" onchange="loadAttendance()">
            <option value="">Select Class</option>${classes.map(c=>`<option value="${c.id}">${esc(c.name)}</option>`).join('')}
          </select>
        </div>
        <div class="form-group" style="margin:0;flex:1;max-width:200px;"><label style="font-size:11px;color:var(--muted);margin-bottom:6px;display:block;">DATE</label>
          <input class="form-control" id="att-date" type="date" value="${today}" onchange="loadAttendance()">
        </div>
        ${currentUser.role !== 'student' ? `<button class="btn btn-success" onclick="saveAttendance()" style="align-self:flex-end;">Save Attendance</button>` : ''}
      </div>
    </div>
    <div class="card" id="att-list"><div class="empty-state"><p>Select a class and date to view attendance</p></div></div>
  `;
}

let attendanceData = {};
async function loadAttendance() {
  const classId = v('att-class'); const date = v('att-date');
  if (!classId || !date) return;
  const records = await get(`/api/attendance?class_id=${classId}&date=${date}`);
  attendanceData = {};
  records.forEach(r => { attendanceData[r.student_id] = r.status || 'present'; });
  const el = document.getElementById('att-list');
  el.innerHTML = records.length ? `
    <div class="card-title">Attendance â€” ${date}</div>
    ${records.map(r => `
      <div class="att-row">
        <div>
          <strong>${esc(r.student_name)}</strong>
          <div style="font-size:12px;color:var(--muted);">${esc(r.roll_number)}</div>
        </div>
        ${currentUser.role !== 'student' ? `
        <div class="att-btns">
          <button class="att-btn present ${attendanceData[r.student_id]==='present'?'active':''}" onclick="setAtt(${r.student_id},'present',this)">Present</button>
          <button class="att-btn absent ${attendanceData[r.student_id]==='absent'?'active':''}" onclick="setAtt(${r.student_id},'absent',this)">Absent</button>
          <button class="att-btn late ${attendanceData[r.student_id]==='late'?'active':''}" onclick="setAtt(${r.student_id},'late',this)">Late</button>
        </div>` : `<span class="badge ${attendanceData[r.student_id]==='present'?'badge-green':attendanceData[r.student_id]==='absent'?'badge-red':'badge-yellow'}">${attendanceData[r.student_id]||'â€”'}</span>`}
      </div>
    `).join('')}
  ` : '<div class="empty-state" style="padding:40px;"><p>No students in this class</p></div>';
}

function setAtt(studentId, status, btn) {
  attendanceData[studentId] = status;
  btn.closest('.att-btns').querySelectorAll('.att-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

async function saveAttendance() {
  const classId = v('att-class'); const date = v('att-date');
  if (!classId || !date) return toast('Select class and date', 'error');
  const records = Object.entries(attendanceData).map(([student_id, status]) => ({ student_id: parseInt(student_id), class_id: parseInt(classId), date, status }));
  if (!records.length) return toast('No students to save', 'error');
  try { await post('/api/attendance', { records }); toast('Attendance saved!'); } catch (e) { toast(e.message, 'error'); }
}

// ==================== GRADES ====================
async function renderGrades() {
  const content = document.getElementById('page-content');
  if (currentUser.role !== 'student') {
    document.getElementById('topbar-actions').innerHTML = `<button class="btn btn-primary" onclick="openAddGrade()">+ Add Grade</button>`;
  }
  let url = '/api/grades';
  const grades = await get(url);
  content.innerHTML = `
    <div class="card">
      <div class="table-wrap">
        <table>
          <thead><tr><th>Student</th><th>Subject</th><th>Exam Type</th><th>Marks</th><th>Grade</th><th>Date</th>${currentUser.role !== 'student' ? '<th>Actions</th>' : ''}</tr></thead>
          <tbody>${grades.length ? grades.map(g => `
            <tr>
              <td><strong>${esc(g.student_name)}</strong></td>
              <td><span class="badge badge-blue">${esc(g.subject_code)}</span> ${esc(g.subject_name)}</td>
              <td>${esc(g.exam_type)}</td>
              <td>${g.marks_obtained}/${g.total_marks}</td>
              <td><span class="badge ${gradeColor(g.grade_letter)}">${g.grade_letter || computeGrade(g.marks_obtained, g.total_marks)}</span></td>
              <td>${formatDate(g.date)}</td>
              ${currentUser.role !== 'student' ? `<td><button class="btn btn-sm btn-danger" onclick="deleteGrade(${g.id})">Delete</button></td>` : ''}
            </tr>
          `).join('') : `<tr><td colspan="7"><div class="empty-state" style="padding:40px;"><p>No grades found</p></div></td></tr>`}</tbody>
        </table>
      </div>
    </div>
  `;
}

function computeGrade(marks, total) {
  const pct = (marks / total) * 100;
  if (pct >= 90) return 'A+'; if (pct >= 80) return 'A'; if (pct >= 70) return 'B';
  if (pct >= 60) return 'C'; if (pct >= 50) return 'D'; return 'F';
}
function gradeColor(g) {
  if (!g) return 'badge-muted';
  if (g.startsWith('A')) return 'badge-green'; if (g === 'B' || g === 'C') return 'badge-blue';
  if (g === 'D') return 'badge-yellow'; return 'badge-red';
}

async function openAddGrade() {
  const [students, subjects] = await Promise.all([get('/api/students'), get('/api/subjects')]);
  openModal(`
    <div class="modal-title">Add Grade</div>
    <div class="form-row">
      <div class="form-group"><label>Student *</label>
        <select class="form-control" id="g-student"><option value="">Select Student</option>${students.map(s=>`<option value="${s.id}">${esc(s.name)} (${s.roll_number})</option>`).join('')}</select>
      </div>
      <div class="form-group"><label>Subject *</label>
        <select class="form-control" id="g-subject"><option value="">Select Subject</option>${subjects.map(s=>`<option value="${s.id}">${esc(s.name)}</option>`).join('')}</select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Exam Type *</label>
        <select class="form-control" id="g-type"><option>Mid-Term</option><option>Final</option><option>Quiz</option><option>Assignment</option><option>Practical</option></select>
      </div>
      <div class="form-group"><label>Grade Letter</label>
        <select class="form-control" id="g-letter"><option value="">Auto</option><option>A+</option><option>A</option><option>B</option><option>C</option><option>D</option><option>F</option></select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Marks Obtained *</label><input class="form-control" id="g-marks" type="number" placeholder="e.g. 85"></div>
      <div class="form-group"><label>Total Marks</label><input class="form-control" id="g-total" type="number" value="100"></div>
    </div>
    <div class="form-group"><label>Remarks</label><input class="form-control" id="g-remarks" placeholder="Optional remarks"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveGrade()">Add Grade</button>
    </div>
  `);
}

async function saveGrade() {
  try {
    await post('/api/grades', { student_id: v('g-student'), subject_id: v('g-subject'), exam_type: v('g-type'), marks_obtained: v('g-marks'), total_marks: v('g-total'), grade_letter: v('g-letter'), remarks: v('g-remarks') });
    closeModal(); toast('Grade added!'); renderGrades();
  } catch (e) { toast(e.message, 'error'); }
}

async function deleteGrade(id) {
  if (!confirm('Delete this grade?')) return;
  try { await del(`/api/grades/${id}`); toast('Deleted!'); renderGrades(); } catch (e) { toast(e.message, 'error'); }
}

// ==================== FEES ====================
async function renderFees() {
  const content = document.getElementById('page-content');
  if (currentUser.role === 'admin') {
    document.getElementById('topbar-actions').innerHTML = `<button class="btn btn-primary" onclick="openAddFee()">+ Add Fee</button>`;
  }
  const fees = await get('/api/fees');
  content.innerHTML = `
    <div class="card">
      <div class="table-wrap">
        <table>
          <thead><tr><th>Student</th><th>Fee Type</th><th>Amount</th><th>Due Date</th><th>Status</th>${currentUser.role === 'admin' ? '<th>Actions</th>' : ''}</tr></thead>
          <tbody>${fees.length ? fees.map(f => `
            <tr>
              <td><strong>${esc(f.student_name)}</strong><br><small style="color:var(--muted)">${esc(f.roll_number)}</small></td>
              <td>${esc(f.fee_type)}</td>
              <td style="font-family:Syne,sans-serif;font-weight:700;">$${parseFloat(f.amount).toFixed(2)}</td>
              <td>${f.due_date ? formatDate(f.due_date) : 'â€”'}</td>
              <td><span class="badge ${f.status==='paid'?'badge-green':f.status==='overdue'?'badge-red':'badge-yellow'}">${f.status}</span></td>
              ${currentUser.role === 'admin' ? `<td>
                ${f.status !== 'paid' ? `<button class="btn btn-sm btn-success" onclick="markPaid(${f.id})">Mark Paid</button> ` : ''}
                <button class="btn btn-sm btn-danger" onclick="deleteFee(${f.id})">Delete</button>
              </td>` : ''}
            </tr>
          `).join('') : `<tr><td colspan="6"><div class="empty-state" style="padding:40px;"><p>No fee records</p></div></td></tr>`}</tbody>
        </table>
      </div>
    </div>
  `;
}

async function openAddFee() {
  const students = await get('/api/students');
  openModal(`
    <div class="modal-title">Add Fee Record</div>
    <div class="form-group"><label>Student *</label>
      <select class="form-control" id="f-student"><option value="">Select Student</option>${students.map(s=>`<option value="${s.id}">${esc(s.name)} (${s.roll_number})</option>`).join('')}</select>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Fee Type *</label>
        <select class="form-control" id="f-type"><option>Tuition</option><option>Library</option><option>Sports</option><option>Transport</option><option>Exam</option><option>Other</option></select>
      </div>
      <div class="form-group"><label>Amount *</label><input class="form-control" id="f-amount" type="number" placeholder="e.g. 500"></div>
    </div>
    <div class="form-group"><label>Due Date</label><input class="form-control" id="f-due" type="date"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveFee()">Add Fee</button>
    </div>
  `);
}

async function saveFee() {
  try {
    await post('/api/fees', { student_id: v('f-student'), fee_type: v('f-type'), amount: v('f-amount'), due_date: v('f-due') });
    closeModal(); toast('Fee added!'); renderFees();
  } catch (e) { toast(e.message, 'error'); }
}

async function markPaid(id) {
  try { await put(`/api/fees/${id}/pay`); toast('Marked as paid!'); renderFees(); } catch (e) { toast(e.message, 'error'); }
}

async function deleteFee(id) {
  if (!confirm('Delete fee record?')) return;
  try { await del(`/api/fees/${id}`); toast('Deleted!'); renderFees(); } catch (e) { toast(e.message, 'error'); }
}

// ==================== TIMETABLE ====================
async function renderTimetable() {
  const content = document.getElementById('page-content');
  const classes = await get('/api/classes');
  if (currentUser.role === 'admin') {
    document.getElementById('topbar-actions').innerHTML = `<button class="btn btn-primary" onclick="openAddTT()">+ Add Slot</button>`;
  }
  content.innerHTML = `
    <div class="card" style="margin-bottom:20px;">
      <div class="form-group" style="margin:0;max-width:200px;">
        <label style="font-size:11px;color:var(--muted);margin-bottom:6px;display:block;">SELECT CLASS</label>
        <select class="form-control" id="tt-class" onchange="loadTT()">
          <option value="">Select Class</option>${classes.map(c=>`<option value="${c.id}">${esc(c.name)}</option>`).join('')}
        </select>
      </div>
    </div>
    <div id="tt-content"><div class="empty-state"><p>Select a class to view timetable</p></div></div>
  `;
}

async function loadTT() {
  const classId = v('tt-class');
  if (!classId) return;
  const slots = await get(`/api/timetable?class_id=${classId}`);
  const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
  const byDay = {};
  days.forEach(d => byDay[d] = []);
  slots.forEach(s => { if (byDay[s.day_of_week]) byDay[s.day_of_week].push(s); });

  document.getElementById('tt-content').innerHTML = `
    <div class="card">
      <div class="tt-grid">
        ${days.map(day => `
          <div class="tt-day">
            <div class="tt-day-name">${day}</div>
            ${byDay[day].length ? byDay[day].map(s => `
              <div class="tt-slot">
                <div class="tt-slot-subject">${esc(s.subject_name)}</div>
                <div class="tt-slot-time">${s.start_time} â€“ ${s.end_time}</div>
                <div style="font-size:10px;color:var(--muted);margin-top:2px;">${esc(s.teacher_name||'')}</div>
                ${currentUser.role === 'admin' ? `<button onclick="deleteTT(${s.id})" style="background:none;border:none;cursor:pointer;color:var(--red);font-size:10px;margin-top:4px;">âœ• Remove</button>` : ''}
              </div>
            `).join('') : `<div style="font-size:12px;color:var(--muted);padding:8px;">No classes</div>`}
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

async function openAddTT() {
  const [classes, subjects] = await Promise.all([get('/api/classes'), get('/api/subjects')]);
  openModal(`
    <div class="modal-title">Add Timetable Slot</div>
    <div class="form-row">
      <div class="form-group"><label>Class *</label>
        <select class="form-control" id="tt-cls"><option value="">Select</option>${classes.map(c=>`<option value="${c.id}">${esc(c.name)}</option>`).join('')}</select>
      </div>
      <div class="form-group"><label>Subject *</label>
        <select class="form-control" id="tt-sub"><option value="">Select</option>${subjects.map(s=>`<option value="${s.id}">${esc(s.name)}</option>`).join('')}</select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Day *</label>
        <select class="form-control" id="tt-day"><option>Monday</option><option>Tuesday</option><option>Wednesday</option><option>Thursday</option><option>Friday</option></select>
      </div>
      <div class="form-group"><label>Start Time *</label><input class="form-control" id="tt-start" type="time"></div>
    </div>
    <div class="form-group"><label>End Time *</label><input class="form-control" id="tt-end" type="time"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveTT()">Add Slot</button>
    </div>
  `);
}

async function saveTT() {
  try {
    await post('/api/timetable', { class_id: v('tt-cls'), subject_id: v('tt-sub'), day_of_week: v('tt-day'), start_time: v('tt-start'), end_time: v('tt-end') });
    closeModal(); toast('Slot added!'); loadTT();
  } catch (e) { toast(e.message, 'error'); }
}

async function deleteTT(id) {
  if (!confirm('Remove this slot?')) return;
  try { await del(`/api/timetable/${id}`); toast('Removed!'); loadTT(); } catch (e) { toast(e.message, 'error'); }
}

// ==================== ANNOUNCEMENTS ====================
async function renderAnnouncements() {
  const content = document.getElementById('page-content');
  if (['admin','teacher'].includes(currentUser.role)) {
    document.getElementById('topbar-actions').innerHTML = `<button class="btn btn-primary" onclick="openAddAnnounce()">+ New Announcement</button>`;
  }
  const list = await get('/api/announcements');
  content.innerHTML = `
    <div class="card">
      ${list.length ? list.map(a => `
        <div class="announce-item">
          <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;">
            <div>
              <div class="announce-title">${esc(a.title)}</div>
              <div class="announce-meta">By ${esc(a.author_name)} Â· ${formatDate(a.created_at)} Â· <span class="badge badge-muted">${a.target_role}</span></div>
              <div class="announce-body">${esc(a.content)}</div>
            </div>
            ${currentUser.role !== 'student' ? `<button class="btn btn-sm btn-danger" onclick="deleteAnnounce(${a.id})">Delete</button>` : ''}
          </div>
        </div>
      `).join('') : '<div class="empty-state" style="padding:60px;"><p>No announcements yet</p></div>'}
    </div>
  `;
}

async function openAddAnnounce() {
  openModal(`
    <div class="modal-title">New Announcement</div>
    <div class="form-group"><label>Title *</label><input class="form-control" id="a-title" placeholder="Announcement title"></div>
    <div class="form-group"><label>Message *</label><textarea class="form-control" id="a-content" rows="4" placeholder="Announcement content..." style="resize:vertical;"></textarea></div>
    <div class="form-group"><label>Target Audience</label>
      <select class="form-control" id="a-target"><option value="all">Everyone</option><option value="teacher">Teachers</option><option value="student">Students</option></select>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveAnnounce()">Publish</button>
    </div>
  `);
}

async function saveAnnounce() {
  try {
    await post('/api/announcements', { title: v('a-title'), content: v('a-content'), target_role: v('a-target') });
    closeModal(); toast('Announcement published!'); renderAnnouncements();
  } catch (e) { toast(e.message, 'error'); }
}

async function deleteAnnounce(id) {
  if (!confirm('Delete announcement?')) return;
  try { await del(`/api/announcements/${id}`); toast('Deleted!'); renderAnnouncements(); } catch (e) { toast(e.message, 'error'); }
}

// ==================== UTILS ====================
function v(id) { const el = document.getElementById(id); return el ? el.value : ''; }
function esc(str) { if (!str) return ''; return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function formatDate(d) { if (!d) return 'â€”'; return new Date(d).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }); }

async function loadClassFilter(elId) {
  const classes = await get('/api/classes');
  const el = document.getElementById(elId);
  if (!el) return;
  classes.forEach(c => { const opt = document.createElement('option'); opt.value = c.id; opt.textContent = c.name; el.appendChild(opt); });
}

// ==================== ICONS ====================
function iconDashboard() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>`; }
function iconStudents() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87m-4-12a4 4 0 0 1 0 7.75"/></svg>`; }
function iconTeachers() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`; }
function iconClasses() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>`; }
function iconSubjects() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>`; }
function iconAttend() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>`; }
function iconGrades() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>`; }
function iconFees() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>`; }
function iconTT() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>`; }
function iconAnnounce() { return `<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 17H2a3 3 0 0 0 3-3V9a7 7 0 0 1 14 0v5a3 3 0 0 0 3 3zm-8.27 4a2 2 0 0 1-3.46 0"/></svg>`; }

// Badge muted
const style = document.createElement('style');
style.textContent = '.badge-cyan { background: rgba(76,201,240,0.12); color: #0891b2; }';
document.head.appendChild(style);

// ==================== START ====================
init();
</script>
</body>
</html>
